plugins {
    id "com.github.node-gradle.node" version "7.1.0"
}

apply from: 'javaproject.gradle'
apply from: 'repository.gradle'


dependencies {
    api project(':api-openbis-java'),
            project(':server-original-data-store')

    implementation 'fasterxml:jackson-annotations:2.9.10',
            'fasterxml:jackson-core:2.9.10',
            'fasterxml:jackson-databind:2.9.10.8',
            'fasterxml:jackson-datatype-jsr310:2.9.10'

    testImplementation 'junit:junit:4.10',
            'testng:testng:6.8-CISD'

    testRuntimeOnly 'hamcrest:hamcrest-core:1.3',
            project(':server-original-data-store')
}

sourceSets {
    main {
        resources {
            srcDirs = ['source/java/*']
        }
    }
    test {
        resources {
            srcDirs = ['sourceTest/java']
        }
    }
}


def imagingTechnologyName = 'openBIS-imaging-technology.jar'

// Dependencies for Jar
configurations.create('apiDependenciesIncluded')
dependencies {
    apiDependenciesIncluded project(':api-openbis-java'),
            project(':server-application-server'),
            project(':lib-commonbase'),
            project(':lib-logging'),
            project(':server-original-data-store')
}

jar {
    dependsOn compileJava
    duplicatesStrategy 'include'
    archiveFileName = imagingTechnologyName
    includeEmptyDirs false
    from sourceSets.main.allSource
//    from(configurations.apiDependenciesIncluded.collect { zipTree(it) }) {
//        include '**/ch/ethz/sis/openbis/**'
//        include '**/ch/systemsx/cisd/openbis/**'
//        include '**/ch/systemsx/cisd/common/exceptions/**'
//        include '**/ch/ethz/sis/shared/log/classic/**'
//        include '**/ch/systemsx/cisd/openbis/dss/generic/shared/**'
//
//    }
}

tasks.register('releaseImagingTechnology', Copy) {
    dependsOn jar
    from("${project.buildDir}/libs/${imagingTechnologyName}")
    into ".."
    doLast {
//        delete "${project.buildDir}/${imagingTechnologyName}"
//        delete "${project.buildDir}"
//        delete
    }
}








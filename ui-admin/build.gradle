plugins {
    id "com.github.node-gradle.node" version "7.1.0"
}

configure(allprojects) {
    apply plugin: 'base'

    repositories {
        mavenCentral()
    }
}

node {
    download = true
    version = '20.18.0'
    workDir = file("${projectDir}/node/nodejs")
    //nodeModulesDir = file("${projectDir}")
}

task cleanBuild(type: Delete) {
    delete 'build'
}

task copyCorePlugins(type: Copy) {
    from file('src/core-plugins')
    into file('build/core-plugins')
}

task copyWebApp(type: Copy) {
    from file('build/js')
    into file('build/core-plugins/admin/1/as/webapps/admin/html')
}

task test {
    dependsOn npm_run_test
}

task installComponents(type: NpmTask) {
    args = ['run', 'components']
}

task copyComponents(type: Copy) {
    dependsOn installComponents
    from('build/components/js')
    into "../ui-eln-lims/src/core-plugins/eln-lims/1/as/webapps/eln-lims/html/lib/react"
}

npm_run_build.dependsOn cleanBuild
copyCorePlugins.dependsOn npm_run_build
copyWebApp.dependsOn copyCorePlugins
build.dependsOn copyWebApp
build.dependsOn test